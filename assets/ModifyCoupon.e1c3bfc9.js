import{g as G}from"./assets.6f11792f.js";import{d as x,a5 as W,a6 as X,a7 as Z,u as H,G as d,l as I,a as J,a4 as A,m as Y,_ as q,b as h,j as l,w as K,i as e,k as v,o as b,x as F,p as Q,F as M,e as ee,t as E,Y as L,c as ne}from"./index.f8ca9675.js";import{S as R}from"./sweetalert2.d8000a3b.js";import{c as oe,a as O}from"./object.a52185a5.js";import{s as le,c as de}from"./citiesInNigeria.a5c184d7.js";import{d as j}from"./defaultData.9a1fdc93.js";import{E as N}from"./errorHandler.ce533688.js";import{M as ie}from"./multiselect.bc727701.js";import{T as ce}from"./TableFooter.3f00d523.js";import{f as re}from"./formatDate.672d0471.js";import"./TableFooter.vue_vue_type_script_lang.5421c060.js";const ue=x({name:"add-inventory-modal",components:{ErrorMessage:W,Field:X,VForm:Z},setup(){const o=J(),a=H(),{user:D,token:$,refreshProfile:g}=a,i=d(null),c=d(["",""]),r=d(null);d();const p=d(null),_=d(null),{API_URL:s,badInternetAlert:k,errorAlert:y,successAlert:z}=Y,n=d(j.CouponEmpty),T=oe().shape({couponCode:O().required().label("Coupon Code"),forUseBy:O().required().label("For Use By"),maxUse:O().required().label("MaxUse")}),w=async()=>{const t=await A.get(s+"customers",{headers:{Authorization:`Bearer ${$}`}}).then(u=>u.data).catch(u=>{N(u)});console.log(t),_.value=t.data},V=async t=>(await A.get(s+"coupon/"+t,{headers:{Authorization:`Bearer ${$}`}}).then(m=>m.data).catch(m=>{R.fire({text:m.message,icon:"error",title:"Error Fetching Data!",buttonsStyling:!1,confirmButtonText:"Close",heightAuto:!1,customClass:{confirmButton:"btn fw-semobold btn-light-danger"}})})).data;I(()=>{w();const{couponId:t}=o.params;t&&(async()=>{const m=await V(t);console.log(m),n.value.code=m.code,n.value.validFrom=m.validFrom,n.value.validUntill=m.validUntill,n.value.couponType=m.couponType,n.value.percentageDiscount=m.percentageDiscount,n.value.reductionAmount=m.reductionAmount,n.value.maxUses=m.maxUses,n.value.forUseBy=m.forUseBy,n.value.createdAt=m.createdAt,n.value.currentUses=m.currentUses})()});const S=async()=>{i.value&&(i.value.disabled=!0,i.value.setAttribute("data-kt-indicator","on"));const t=new FormData;console.log(n.value),t.append("code",n.value.code),t.append("valid_from",n.value.validFrom),t.append("valid_until",n.value.validUntill),t.append("max_uses",n.value.maxUses),t.append("coupon_type",n.value.couponType),n.value.couponType==="percentageDiscount"&&t.append("percentage_discount",n.value.percentageDiscount),n.value.couponType==="reductionDiscount"&&t.append("reduction_amount",n.value.reductionAmount),t.append("for_user",JSON.stringify([n.value.forUseBy])),await A.post(s+"coupon",t,{headers:{Authorization:`Bearer ${$}`}}).then(()=>{R.fire({text:"Coupon has been created!",icon:"success",buttonsStyling:!1,confirmButtonText:"Ok!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})}).catch(u=>{N(u)}).then(()=>{var u;(u=i.value)==null||u.removeAttribute("data-kt-indicator"),i.value.disabled=!1})},B=t=>{const[u,m]=t;console.log(t);const P=new Date(u),te=new Date(m),se=P.toISOString().replace("T"," ").slice(0,-5),ae=te.toISOString().replace("T"," ").slice(0,-5);n.value.validFrom=se,n.value.validUntill=ae},C=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let u="";for(let m=0;m<8;m++)u+=t.charAt(Math.floor(Math.random()*t.length));n.value.code=u},f=async()=>{var t;!i.value||(i.value.disabled=!0,i.value.setAttribute("data-kt-indicator","on"),await S(),(t=i.value)==null||t.removeAttribute("data-kt-indicator"),i.value.disabled=!1)},U=d([n.value.validFrom,n.value.validUntill]);return{modifyCouponData:n,validationSchema:T,submit:f,submitButtonRef:i,modalRef:r,createAPIKeyModalRef:p,getAssetPath:G,statesInNigeria:le,citiesInNigeria:de,AllCustomers:_,generateCouponCode:C,handleCouponValidity:B,validity:c,DateDefault:U}}}),me={class:"card"},pe=e("div",{class:"card-header"},[e("h2",{class:"fw-bold my-10"},"Edit Coupon")],-1),_e={class:"card-body"},fe={class:"mb-5 row"},he={class:"col-12 col-lg-6"},be=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Coupon Code",-1),ve={class:"fv-plugins-message-container"},ge={class:"fv-help-block"},ye={class:"col-12 col-lg-6 py-9"},Ce=e("span",{class:"indicator-label"}," Generate Coupon Code ",-1),$e=[Ce],we={class:"mb-5 row"},De={class:"col-12 col-md-6 col-lg-3"},ke=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Maximum usage",-1),Ue={class:"fv-plugins-message-container"},Ae={class:"fv-help-block"},Te={class:"col-12 col-md-6 col-lg-3"},Ve=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Current Uses",-1),Se={class:"fv-plugins-message-container"},Pe={class:"fv-help-block"},Fe={class:"mb-5 row"},Be={class:"col-12 col-lg-6"},Ee=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Valid From",-1),Ie={class:"position-relative align-items-center"},Me={class:"demo-datetime-pickeqr"},Re={class:"fv-plugins-message-container"},Ne={class:"fv-help-block"},xe={class:"fv-plugins-message-container"},qe={class:"fv-help-block"},ze={class:"col-12 col-lg-6"},Le=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Coupon Type",-1),Oe={class:"fv row mb-10"},Ke={class:"col-6 form-check form-check-custom form-check-solid"},je=e("label",{class:"form-check-label",for:"flexCheckDefault"},"Percentage Discount",-1),Ge={class:"col-6 form-check form-check-custom form-check-solid"},He=e("label",{class:"form-check-label",for:"flexCheckDefault"},"Reduction Discount",-1),Je={class:"mb-5 row"},Ye={key:0,class:"col-12 col-lg-6"},Qe=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Percentage of decrease",-1),We={class:"fv-plugins-message-container"},Xe={class:"fv-help-block"},Ze={key:1,class:"col-12 col-lg-6"},eo=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"},"Reduction amount",-1),oo={class:"fv-plugins-message-container"},to={class:"fv-help-block"},so={class:"card-footer flex-center"},ao=e("button",{type:"reset",class:"btn btn-light me-3"},"Discard",-1),no={ref:"submitButtonRef",type:"submit",id:"kt_add_customer_submit",class:"btn btn-primary"},lo=e("span",{class:"indicator-label"}," Submit ",-1),io=e("span",{class:"indicator-progress"},[Q(" Please wait... "),e("span",{class:"spinner-border spinner-border-sm align-middle ms-2"})],-1),co=[lo,io];function ro(o,a,D,$,g,i){const c=v("Field"),r=v("ErrorMessage"),p=v("el-date-picker"),_=v("VForm");return b(),h("div",me,[pe,l(_,{id:"kt_modal_add_customer_form",class:"form",onSubmit:o.submit,"validation-schema":o.validationSchema},{default:K(({})=>[e("div",_e,[e("div",fe,[e("div",he,[be,l(c,{type:"text",disabled:!0,class:"form-control form-control-solid",placeholder:"Generated Coupon Code",name:"couponCode","aria-disabled":"true",modelValue:o.modifyCouponData.code,"onUpdate:modelValue":a[0]||(a[0]=s=>o.modifyCouponData.code=s)},null,8,["modelValue"]),e("div",ve,[e("div",ge,[l(r,{name:"couponCode"})])])]),e("div",ye,[e("button",{onClick:a[1]||(a[1]=(...s)=>o.generateCouponCode&&o.generateCouponCode(...s)),type:"button",id:"kt_add_customer_submit",class:"btn btn-block btn-primary"},$e)])]),e("div",we,[e("div",De,[ke,l(c,{type:"number",class:"form-control form-control-solid",placeholder:"Enter Coupon Max use",name:"maxUse","aria-disabled":"true",modelValue:o.modifyCouponData.maxUses,"onUpdate:modelValue":a[2]||(a[2]=s=>o.modifyCouponData.maxUses=s)},null,8,["modelValue"]),e("div",Ue,[e("div",Ae,[l(r,{name:"maxUse"})])])]),e("div",Te,[Ve,l(c,{type:"number",class:"form-control form-control-solid",placeholder:"Current Uses",name:"currentUses",disabled:"true",modelValue:o.modifyCouponData.currentUses,"onUpdate:modelValue":a[3]||(a[3]=s=>o.modifyCouponData.currentUses=s)},null,8,["modelValue"]),e("div",Se,[e("div",Pe,[l(r,{name:"currentUses"})])])])]),e("div",Fe,[e("div",Be,[Ee,e("div",Ie,[e("div",Me,[l(p,{modelValue:o.DateDefault,"onUpdate:modelValue":a[4]||(a[4]=s=>o.DateDefault=s),name:["validFrom","validUntil"],onChange:o.handleCouponValidity,placeholder:"Select date and time",type:"daterange","range-separator":"To","start-placeholder":"valid from","end-placeholder":"valid until",size:"large"},null,8,["modelValue","onChange"])])]),e("div",Re,[e("div",Ne,[l(r,{name:"Start"})])]),e("div",xe,[e("div",qe,[l(r,{name:"Stop"})])])]),e("div",ze,[Le,e("div",Oe,[e("div",Ke,[l(c,{class:"form-check-input",name:"couponType",modelValue:o.modifyCouponData.couponType,"onUpdate:modelValue":a[5]||(a[5]=s=>o.modifyCouponData.couponType=s),type:"radio",value:"percentageDiscount"},null,8,["modelValue"]),je]),e("div",Ge,[l(c,{modelValue:o.modifyCouponData.couponType,"onUpdate:modelValue":a[6]||(a[6]=s=>o.modifyCouponData.couponType=s),class:"form-check-input",name:"couponType",type:"radio",value:"reductionDiscount"},null,8,["modelValue"]),He])])])]),e("div",Je,[o.modifyCouponData.couponType==="percentageDiscount"?(b(),h("div",Ye,[Qe,l(c,{type:"number",class:"form-control form-control-solid",placeholder:"Enter decrease percentage",name:"percentageDiscount","aria-disabled":"true",max:"100",modelValue:o.modifyCouponData.percentageDiscount,"onUpdate:modelValue":a[7]||(a[7]=s=>o.modifyCouponData.percentageDiscount=s)},null,8,["modelValue"]),e("div",We,[e("div",Xe,[l(r,{name:"percentageDiscount"})])])])):F("",!0),o.modifyCouponData.couponType==="reductionDiscount"?(b(),h("div",Ze,[eo,l(c,{type:"number",class:"form-control form-control-solid",placeholder:"Enter Reduction amount",name:"reductionDiscount","aria-disabled":"true",modelValue:o.modifyCouponData.reductionAmount,"onUpdate:modelValue":a[8]||(a[8]=s=>o.modifyCouponData.reductionAmount=s)},null,8,["modelValue"]),e("div",oo,[e("div",to,[l(r,{name:"reductionDiscount"})])])])):F("",!0)])]),e("div",so,[ao,e("button",no,co,512)])]),_:1},8,["onSubmit","validation-schema"])])}const uo=q(ue,[["render",ro]]),mo=x({name:"add-admin-modal",components:{ErrorMessage:W,Field:X,VForm:Z},setup(){const o=H(),{user:a,token:D,refreshProfile:$}=o,g=J(),i=d(""),c=d([]),r=d(!1),p=d(null),_=d(null);d(null);const s=d(null),{API_URL:k,badInternetAlert:y,errorAlert:z,successAlert:n}=Y,T=async()=>{const C=await A.get(k+"customers",{headers:{Authorization:`Bearer ${D}`}}).then(f=>f.data).catch(f=>{R.fire({text:f.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Error Fetching Data!",heightAuto:!1,customClass:{confirmButton:"btn fw-semobold btn-light-danger"}})});return c.value=C.data,C.data};I(()=>{T()});const w=d({firstName:"",lastName:"",email:"",userName:"",password:"",permissions:[],phone_number:""}),V=oe().shape({});I(()=>{_.value=document.getElementById("kt_modal_add_admin")});const S=async()=>{p.value&&(p.value.disabled=!0,p.value.setAttribute("data-kt-indicator","on"));const{couponId:C}=g.params,f=new FormData;r.value?(f.append("customer_id","*"),f.append("allow_all","true")):(f.append("customer_id",i.value),f.append("allow_all","false")),f.append("coupon_id",`${C}`),await A.post(k+"coupon",f,{headers:{Authorization:`Bearer ${D}`}}).then(()=>{R.fire({text:"User Added Successfully!",icon:"success",buttonsStyling:!1,confirmButtonText:"Ok!",heightAuto:!1,customClass:{confirmButton:"btn btn-primary"}})}).catch(U=>{N(U)})};return{newAdminData:w,validationSchema:V,submit:async()=>{var C;!p.value||(await S(),p.value.disabled=!0,p.value.setAttribute("data-kt-indicator","on"),(C=p.value)==null||C.removeAttribute("data-kt-indicator"),p.value.disabled=!1)},submitButtonRef:p,modalRef:s,getAssetPath:G,Multiselect:ie,allUsers:c,userToUpload:i,allow_all_cumtomers:r}}}),po={class:"modal fade",id:"kt_modal_add_admin",ref:"addDriverModalRef",tabindex:"-1","aria-hidden":"true"},_o={class:"modal-dialog modal-dialog-centered mw-650px"},fo={class:"modal-content"},ho={class:"modal-header",id:"kt_modal_add_admin_header"},bo=e("h2",{class:"fw-bold"},"Add user to coupon",-1),vo={id:"kt_modal_add_admin_close","data-bs-dismiss":"modal",class:"btn btn-icon btn-sm btn-active-icon-primary"},go={class:"modal-body py-10 px-lg-17"},yo={class:"scroll-y me-n7 pe-7",id:"kt_modal_add_admin_scroll","data-kt-scroll":"true","data-kt-scroll-activate":"{default: false, lg: true}","data-kt-scroll-max-height":"auto","data-kt-scroll-dependencies":"#kt_modal_add_admin_header","data-kt-scroll-wrappers":"#kt_modal_add_admin_scroll","data-kt-scroll-offset":"300px"},Co={class:"mb-5 row"},$o={class:"col-6"},wo=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"}," Customer",-1),Do=e("option",{value:""},"Select a User",-1),ko=["value"],Uo={class:"fv-plugins-message-container"},Ao={class:"fv-help-block"},To={class:"col-6"},Vo=e("label",{class:"fw-bold required fs-5 fw-semobold mb-2"}," Allow all cumtomers",-1),So={class:"fv row mb-10"},Po={class:"px-2 form-check form-check-custom form-check-solid"},Fo=e("label",{class:"form-check-label",for:"flexCheckDefault"},"Allow all cumtomers",-1),Bo={class:"fv-plugins-message-container"},Eo={class:"fv-help-block"},Io={class:"modal-footer flex-center"},Mo=e("button",{type:"reset",id:"kt_modal_add_admin_cancel",class:"btn btn-light me-3"}," Discard ",-1),Ro={ref:"submitButtonRef",type:"submit",id:"kt_modal_add_admin_submit",class:"btn btn-primary"},No=e("span",{class:"indicator-label"}," Submit ",-1),xo=e("span",{class:"indicator-progress"},[Q(" Please wait... "),e("span",{class:"spinner-border spinner-border-sm align-middle ms-2"})],-1),qo=[No,xo];function zo(o,a,D,$,g,i){const c=v("KTIcon"),r=v("Field"),p=v("ErrorMessage"),_=v("VForm");return b(),h("div",po,[e("div",_o,[e("div",fo,[e("div",ho,[bo,e("div",vo,[l(c,{"icon-name":"cross","icon-class":"fs-1"})])]),l(_,{id:"kt_modal_add_admin_form",class:"form",onSubmit:o.submit,"validation-schema":o.validationSchema},{default:K(()=>[e("div",go,[e("div",yo,[e("div",Co,[e("div",$o,[wo,l(r,{name:"userToUpload",class:"form-select",as:"select",modelValue:o.userToUpload,"onUpdate:modelValue":a[0]||(a[0]=s=>o.userToUpload=s)},{default:K(()=>[Do,(b(!0),h(M,null,ee(o.allUsers,s=>(b(),h("option",{key:s.id||s.email,value:s.id},E(s.lastName+" "+s.firstName),9,ko))),128))]),_:1},8,["modelValue"]),e("div",Uo,[e("div",Ao,[l(p,{name:"userToUpload"})])])]),e("div",To,[Vo,e("div",So,[e("div",Po,[l(r,{class:"form-check-input",name:"allow_all_cumtomers",modelValue:o.allow_all_cumtomers,"onUpdate:modelValue":a[1]||(a[1]=s=>o.allow_all_cumtomers=s),type:"radio",value:!0},null,8,["modelValue"]),Fo])]),e("div",Bo,[e("div",Eo,[l(p,{name:"allow_all_cumtomers"})])])])])])]),e("div",Io,[Mo,e("button",Ro,qo,512)])]),_:1},8,["onSubmit","validation-schema"])])])],512)}const Lo=q(mo,[["render",zo]]),Oo=x({name:"kt-widget-12",components:{AddUserToCoupon:Lo,TableFooter:ce},props:{widgetClasses:String},emits:["page-change","on-sort","on-items-select","on-items-per-page-change"],setup(o,{emit:a}){const D=J(),$=d({}),g=d([]),i=d(j.AdminEmpty),c=d(j.AdminEmpty),r=H(),{token:p}=r,_=d(5),s=d([0]),k=d(0),y=d(!0),{API_URL:z,ASSETS_URL:n}=Y,T=d(""),w=d(1);L(()=>_.value,t=>{w.value=1,a("on-items-per-page-change",t)});const V=ne(()=>s.value?s.value.length<=_.value?k.value:s.value.length:0);L(()=>w.value,async t=>{const u=await U(t);g.value=u.data});const S=async t=>{i.value=t},B=async t=>{c.value=t};L(()=>w.value,async t=>{const u=await U(t);g.value=u.data});const C=t=>{w.value=t,a("page-change",t)},f=async t=>{const{couponId:u}=D.params;return(await A.get(z+"coupon/customers/"+u+`?page=${t}`,{headers:{Authorization:`Bearer ${p}`}}).then(P=>P.data).catch(P=>{g.value=null,N(P)})).data},U=async t=>typeof t=="number"?await f(t):await f(1);return I(async()=>{const t=await U(1);$.value=t,console.log(t),g.value=t.data,k.value=t.total,w.value=t.currentPage}),{search:T,getAssetPath:G,pageChange:C,currentPage:w,itemsPerPage:_,totalDeliveries:s,totalItems:V,dataToDisplay:g,itemsPerPageDropdownEnabled:y,ASSETS_URL:n,editProfileData:i,updateEditProfile:S,viewProfileData:c,updateViewProfile:B,formatDate:re}}}),Ko={class:"card"},jo={class:"card-body pt-0"},Go={class:"card"},Ho={class:"card-header border-0 pt-5"},Jo={class:"card-title align-items-start flex-column"},Yo=e("span",{class:"card-label fw-bold fs-3 mb-1"},"Coupon Users",-1),Qo={class:"text-muted mt-1 fw-semobold fs-7"},Wo={class:"card-toolbar"},Xo={type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#kt_modal_add_admin"},Zo={class:""},et={key:0,class:"d-flex align-items-center justify-content-center w-100 py-5"},ot=e("h4",null,"No Customers",-1),tt=[ot],st={key:1,class:"d-flex align-items-center justify-content-center w-100 py-5"},at=e("div",{class:"spinner-border spinner-border-sm align-middle ms-2 w-25px h-25px"},null,-1),nt=[at],lt={key:2,class:"table-responsive"},dt={class:"table align-middle gs-0 gy-4"},it=e("thead",null,[e("tr",{class:"fw-bold text-muted bg-light"},[e("th",{class:"ps-4 min-w-300px rounded-start"},"Name")])],-1),ct={class:"d-flex align-items-center"},rt={class:"symbol symbol-50px me-5"},ut={class:"symbol-label bg-light"},mt=["src"],pt={class:"d-flex justify-content-start flex-column"},_t={class:"text-dark fw-bold text-hover-primary mb-1 fs-6"},ft={class:"text-muted fw-semobold text-muted d-block fs-7"},ht={class:"px-10"};function bt(o,a,D,$,g,i){var _,s,k;const c=v("KTIcon"),r=v("TableFooter"),p=v("AddUserToCoupon");return b(),h(M,null,[e("div",Ko,[e("div",jo,[e("div",Go,[e("div",Ho,[e("h3",Jo,[Yo,e("span",Qo,E(o.totalItems)+" Users using this coupon",1)]),e("div",Wo,[e("button",Xo,[l(c,{"icon-name":"plus","icon-class":"fs-2"}),Q(" Add Customer ")])])]),e("div",Zo,[(_=o.dataToDisplay)!=null&&_.length?F("",!0):(b(),h("div",et,tt)),!((s=o.dataToDisplay)!=null&&s.length)&&o.dataToDisplay===null?(b(),h("div",st,nt)):F("",!0),((k=o.dataToDisplay)==null?void 0:k.length)&&o.dataToDisplay?(b(),h("div",lt,[e("table",dt,[it,e("tbody",null,[(b(!0),h(M,null,ee(o.dataToDisplay,y=>(b(),h("tr",{key:y.id},[e("td",null,[e("div",ct,[e("div",rt,[e("span",ut,[e("img",{src:y.profile?`${o.ASSETS_URL+y.profile}`:o.getAssetPath("media/avatars/blank.png"),alt:"image",class:"h-75 align-self-end"},null,8,mt)])]),e("div",pt,[e("span",_t,E(y.firstName),1),e("span",ft,E(y.lastName),1)])])])]))),128))])]),e("div",ht,[l(r,{onPageChange:o.pageChange,"current-page":o.currentPage,itemsPerPage:o.itemsPerPage,"onUpdate:itemsPerPage":a[0]||(a[0]=y=>o.itemsPerPage=y),count:o.totalItems,"items-per-page-dropdown-enabled":o.itemsPerPageDropdownEnabled},null,8,["onPageChange","current-page","itemsPerPage","count","items-per-page-dropdown-enabled"])])])):F("",!0)])])])]),l(p)],64)}const vt=q(Oo,[["render",bt]]),gt=x({name:"modify_coupon",components:{ModifyCouponForm:uo,AllCouponUsersTable:vt},props:{},setup(){return{}}}),yt={class:"my-10"};function Ct(o,a,D,$,g,i){const c=v("ModifyCouponForm"),r=v("AllCouponUsersTable");return b(),h(M,null,[e("div",null,[l(c,{"widget-classes":"mb-5 mb-xl-8"})]),e("div",yt,[l(r,{"widget-classes":"m-10 mb-xl-8"})])],64)}const Bt=q(gt,[["render",Ct]]);export{Bt as default};
